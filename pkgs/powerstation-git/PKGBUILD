# Maintainer: William Edwards <shadowapex@gmail.com>
pkgname=powerstation-git
_pkgbase=powerstation
pkgver=v0.4.2.r13.g2f45ac7
pkgrel=1
pkgdesc="Open source performance daemon with DBus interface"
arch=('x86_64')
url="https://github.com/ShadowBlip/PowerStation"
license=('GPL')
depends=('dbus' 'pciutils')
makedepends=('rust' 'make' 'cmake' 'clang' 'git')
provides=('powerstation')
conflicts=('powerstation-bin')
source=("${_pkgbase}::git+https://github.com/honjow/${_pkgbase}.git#branch=dev"
        "0001-fix-ryzenadj-add-error-handling-for-refresh-failures.patch"
)
options=(!lto)

sha256sums=('SKIP'
            'f982171941eb6922342aaab027ae5a5da81d2063de35a38e6d2c61472f1e6a71'
)

pkgver() {
  cd "$srcdir/${_pkgbase}"
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$srcdir/${_pkgbase}"

  # local src
  # for src in "${source[@]}"; do
  #   [[ $src = *.patch ]] || continue
  #   patch -p1 < "${srcdir}"/$src
  # done
}

build() {
  cd "$srcdir/${_pkgbase}"
  make build
}

package() {
  cd "$srcdir/${_pkgbase}"
  make install PREFIX=${pkgdir}/usr NO_RELOAD=true
}
